<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin - Galeri Ekspresi ‚ù§Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>body { font-family: 'Poppins', sans-serif; background: #fcf8f4; }</style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl font-bold text-center text-[#a87e60] mb-10">Koleksi Senyum Si Doi</h1>
        
        <div id="video-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <p id="loading-text" class="text-center col-span-full">Sedang memuat kenangan...</p>
        </div>
    </div>

    <script>
        // Fungsi untuk mengambil data
        async function loadVideos() {
            try {
                const response = await fetch('/api/get-videos');
                const videos = await response.json();
                
                const container = document.getElementById('video-container');
                const loadingText = document.getElementById('loading-text');
                
                container.innerHTML = ""; // Bersihkan container

                if (videos.length === 0) {
                    container.innerHTML = `<p class="text-center col-span-full text-gray-500">Belum ada rekaman yang tersimpan. üòä</p>`;
                    return;
                }

                videos.forEach(vid => {
                    const date = new Date(vid.created_at).toLocaleString('id-ID');
                    const card = document.createElement('div');
                    card.className = "bg-white p-4 rounded-3xl shadow-lg border border-orange-100 flex flex-col";
                    
                    card.innerHTML = `
                        <video src="${vid.video_base64}" controls class="w-full rounded-2xl mb-4 shadow-inner"></video>
                        <div class="px-2 mb-4 flex-grow">
                            <p class="text-xs text-gray-400">ID Rekaman: #${vid.id}</p>
                            <p class="text-md font-semibold text-gray-700">${date}</p>
                        </div>
                        <button onclick="deleteVideo(${vid.id})" class="w-full bg-red-50 text-red-500 hover:bg-red-500 hover:text-white py-2 rounded-xl transition-all duration-300 font-medium">
                            Hapus Rekaman
                        </button>
                    `;
                    container.appendChild(card);
                });
            } catch (error) {
                console.error("Gagal memuat video:", error);
                document.getElementById('loading-text').innerText = "Gagal menyambung ke server.";
            }
        }

        // Fungsi untuk menghapus data
        async function deleteVideo(id) {
            const result = await Swal.fire({
                title: 'Hapus video ini?',
                text: "Kenangan ini akan hilang dari database!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#ef4444',
                cancelButtonColor: '#6b7280',
                confirmButtonText: 'Ya, Hapus!',
                cancelButtonText: 'Batal'
            });

            if (result.isConfirmed) {
                try {
                    const response = await fetch(`/api/delete-video/${id}`, {
                        method: 'DELETE'
                    });
                    const resData = await response.json();

                    if (resData.success) {
                        Swal.fire('Terhapus!', 'Video berhasil dihapus.', 'success');
                        loadVideos(); // Refresh daftar video
                    }
                } catch (error) {
                    Swal.fire('Gagal!', 'Tidak bisa menghapus video.', 'error');
                }
            }
        }

        loadVideos();
    </script>
</body>
</html>